/*! INPOOT - v0.9.4b - 2013-07-31\n* http://johndavidfive.com/inpoot
* Copyright (c) 2013 John David Martin; Licensed MIT */var inpoot={};!function(a){"use strict";var b=function(a,b){return-1!==a.indexOf(b)},c=navigator.userAgent;b(c,"Windows NT"),b(c,"Macintosh"),b(c,"Chrome/");var d=b(c,"Firefox/"),e={};if(d){navigator.mozGamepads=[];var f=function(a){navigator.mozGamepads[a.gamepad.index]=a.gamepad},g=function(a){navigator.mozGamepads[a.gamepad.index]=void 0};window.addEventListener("MozGamepadConnected",f),window.addEventListener("MozGamepadDisconnected",g)}var h,i=function(a){for(var c in inpoot.gamepads)for(var d=inpoot.gamepads[c],e=d.idMatches,f=0;f<e.length;f++){for(var g=e[f],h=!0,i=0;i<g.length;i++)b(a.id,g[i])||(h=!1);if(h)return a.displayName=d.displayName,a.gpadType=c,void 0}a.gpadType=a.id,a.displayName="Unknown gamepad"},j={},k={},l={},m=!1,n=0,o=!1,p=!1,q=1,r={mouse:{},keyboard:{},gamepad:{}},s={},t=function(a){e[a.keyCode]=1},u=function(a){e[a.keyCode]=0},v={1:"mouse_button_left",2:"mouse_button_middle",3:"mouse_button_right"},w=function(a){r.mouse[v[a.which]]=1},x=function(a){r.mouse[v[a.which]]=0},y=function(a){n=0;var b=a.movementX||a.mozMovementX||a.webkitMovementX||0,c=a.movementY||a.mozMovementY||a.webkitMovementY||0;b||c?(r.mouse.mouseDX=b,r.mouse.mouseDY=c):(r.mouse.mouseXL=r.mouse.mouseX,r.mouse.mouseYL=r.mouse.mouseY,r.mouse.mouseX=2*(a.clientX/window.innerWidth)-1,r.mouse.mouseY=2*(a.clientY/window.innerHeight)-1,r.mouse.mouseDX=r.mouse.mouseX-r.mouse.mouseXL,r.mouse.mouseDY=r.mouse.mouseY-r.mouse.mouseYL)},z=function(){return navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.mozGamepads||navigator.gamepads},A=function(){var a=[],b=z(),c=0;for(var d in b)void 0!==b[d]&&"length"!==d&&b.hasOwnProperty(d)&&(c++,i(b[d]),a.push({player:c,gamepad:b[d],gamepadIndex:d}),r.gamepad[d]||(r.gamepad[d]={type:b[d].gpadType,values:{}}));return a};inpoot.initialize=function(b){document.onkeydown=t,document.onkeyup=u,document.onmousemove=y,document.onmousedown=w,document.onmouseup=x,j=A(),k=b.actions,q=b.maxPlayers||1,h=b.mouseNormalizer||3,l=a.storage.getObject("gamepadmaps")||{},b.mappings&&null===a.storage.getObject("inpoot_action_mappings")&&inpoot.setMappings(b.mappings),b.players&&null===a.storage.getObject("inpoot_stored_players")&&inpoot.setPlayers(b.players)};var B=function(){l=a.storage.getObject("gamepadmaps")||{}},C=function(a,b,c){return l[a].rawToButton[b][c]},D=function(a,b,c){var d=O(a);return d[b][c].name||c},E=function(a,b,c){var d,e=l[a].rawToButton.axesMap[b];return e?(d=D(a,"axis_dual",e.bid),"y"===e.subType?0>=c?"down":"up":c>0?"right":"left",{text:d+" "+e.direction,value:e.bid,buttonType:"axis_dual",subType:e.subType,direction:e.direction}):(d=D(a,"button",b),l[a].rawToButton.buttons[b],{text:d,value:b,buttonType:"button",subType:""})},F=0,G=!1;inpoot.refreshParams=function(){G=!0};var H=.35;inpoot.setThreshold=function(a){H=a},inpoot.tick=function(b){if(!m||b){n++,n>1&&(r.mouse.mouseDX=0,r.mouse.mouseDY=0),s=a.extend(!0,{},r),r.keyboard=a.extend(!0,{},e),0===F&&(j=A(),L()),F=(F+1)%1e3,G&&(F=0,G=!1);for(var c=z(),d=0;d<j.length;d++){var f=j[d],g=c[f.gamepadIndex];if(g&&g.gpadType){for(var h=0;h<g.buttons.length;h++)try{r.gamepad[f.gamepadIndex].values[C(g.gpadType,"buttons",h).bid]=g.buttons[h]}catch(i){}for(var k=0;k<g.axes.length;k++){var l=C(g.gpadType,"axes",h),o=Math.abs(g.axes[k]),p=o>H?o:0;"x"===l.subType?g.axes[k]<=0?(r.gamepad[f.gamepadIndex].values[l.bid+"left"]=p,r.gamepad[f.gamepadIndex].values[l.bid+"right"]=0):(r.gamepad[f.gamepadIndex].values[l.bid+"left"]=0,r.gamepad[f.gamepadIndex].values[l.bid+"right"]=p):g.axes[k]<=0?(r.gamepad[f.gamepadIndex].values[l.bid+"up"]=p,r.gamepad[f.gamepadIndex].values[l.bid+"down"]=0):(r.gamepad[f.gamepadIndex].values[l.bid+"up"]=0,r.gamepad[f.gamepadIndex].values[l.bid+"down"]=p)}}}return r}};var I={},J={},K={},L=function(){I={};var b=a.storage.getObject("inpoot_stored_players");for(var c in b){var d=b[c];I[d.number]={actionMapId:d.actionMapId,gamepad:d.gamepad,gamepadIndex:d.options.gpadIndex,invert:d.options.axes}}J=a.storage.getObject("inpoot_action_mappings");for(var e=0;e<J.length;e++)K[J[e].id]=e};inpoot.action=function(a,b,c){c=c||{},b=b||1;var d,e,f,g={pressed:0,delta:0,val:0},i=I[b];if(i&&J[K[i.actionMapId]]&&(d=J[K[i.actionMapId]].mapping[a]))for(var j=d.inputs||[],k=0;k<j.length;k++)for(var l=0;l<j[k].inputs.length;l++)"keyboard"===j[k].inputs[l].type?(void 0===r.keyboard[j[k].inputs[l].value]&&(r.keyboard[j[k].inputs[l].value]=0),e=r.keyboard[j[k].inputs[l].value],f=s.keyboard[j[k].inputs[l].value],g.val=e,g.pressed=!e&&f,g.delta=e-f,g.pressed&&c.clear&&(r.keyboard[j[k].inputs[l].value]=0,s.keyboard[j[k].inputs[l].value]=0)):"gamepad"===j[k].inputs[l].type?r.gamepad[i.gamepadIndex]!==!1&&void 0!==r.gamepad[i.gamepadIndex]&&("axis_dual"===j[k].inputs[l].buttonType?(i.invert&&i.invert[j[k].inputs[l].value]&&("up"===j[k].inputs[l].direction||"down"===j[k].inputs[l].direction)?"up"===j[k].inputs[l].direction?(e=r.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+"down"],f=s.gamepad[i.gamepadIndex]?s.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+"down"]:0):(e=r.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+"up"],f=s.gamepad[i.gamepadIndex]?s.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+"up"]:0):(e=r.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+j[k].inputs[l].direction],f=s.gamepad[i.gamepadIndex]?s.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+j[k].inputs[l].direction]:0),g.val=e,g.pressed=!e&&f,g.delta=e-f,g.pressed&&c.clear&&(r.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+j[k].inputs[l].direction]=0,s.gamepad[i.gamepadIndex].values[j[k].inputs[l].value+j[k].inputs[l].direction]=0)):(e=r.gamepad[i.gamepadIndex].values[j[k].inputs[l].value],f=s.gamepad[i.gamepadIndex]?s.gamepad[i.gamepadIndex].values[j[k].inputs[l].value]:0,g.val=e,g.pressed=!e&&f,g.delta=e-f,g.pressed&&c.clear&&(r.gamepad[i.gamepadIndex].values[j[k].inputs[l].value]=0,s.gamepad[i.gamepadIndex].values[j[k].inputs[l].value]=0))):"mouse"===j[k].inputs[l].type&&("mouse_up"===j[k].inputs[l].value?(e=r.mouse.mouseDY<0?Math.min(Math.abs(r.mouse.mouseDY)/h,1):0,f=s.mouse.mouseDY<0?Math.min(Math.abs(r.mouse.mouseDY)/h,1):0):"mouse_down"===j[k].inputs[l].value?(e=r.mouse.mouseDY>=0?Math.min(r.mouse.mouseDY/h,1):0,f=s.mouse.mouseDY>=0?Math.min(r.mouse.mouseDY/h,1):0):"mouse_left"===j[k].inputs[l].value?(e=r.mouse.mouseDX<0?Math.min(Math.abs(r.mouse.mouseDX)/h,1):0,f=s.mouse.mouseDX<0?Math.min(Math.abs(r.mouse.mouseDX)/h,1):0):"mouse_right"===j[k].inputs[l].value?(e=r.mouse.mouseDX>=0?Math.min(r.mouse.mouseDX/h,1):0,f=s.mouse.mouseDX>=0?Math.min(r.mouse.mouseDX/h,1):0):(e=r.mouse[j[k].inputs[l].value],f=s.mouse[j[k].inputs[l].value]),g.val=e,g.pressed=!e&&f,g.delta=e-f);return g.val||(g.val=0),g.pressed||(g.pressed=0),g.delta||(g.delta=0),g},inpoot.resetConfigs=function(){o&&inpoot.setPlayers(o),p&&inpoot.setMappings(p)},inpoot.getMappings=function(){var b=a.storage.getObject("inpoot_action_mappings");return JSON.stringify(b)},inpoot.setMappings=function(b){"string"==typeof b&&(b=JSON.parse(b)),p=b,a.storage.setObject("inpoot_action_mappings",b)},inpoot.getPlayers=function(){var b=a.storage.getObject("inpoot_stored_players");return JSON.stringify(b)},inpoot.setPlayers=function(b){"string"==typeof b&&(b=JSON.parse(b)),o=b,a.storage.setObject("inpoot_stored_players",b)},inpoot.getRemoteGamepadConfigs=function(){};var M=function(a){var b=inpoot.gamepads[a],c={buttonToRaw:{button:{},axis:{},axis_dual:{}},rawToButton:{buttons:{},axes:{},axesMap:{}}};if(!b)return alert("We do not have configurations stored for this type of gamepad:"+a),void 0;for(var d in b.button)c.buttonToRaw.button[d]=!1;for(var e in b.axis_dual)c.buttonToRaw.axis_dual[e]={x:!1,y:!1};return c},N=function(b){var c=l[b];return c?c:(c=M(b),c?(l[b]=c,a.storage.setObject("gamepadmaps",l),c):!1)},O=function(a){return inpoot.gamepads[a]},P=function(){a.storage.setObject("gamepadmaps",l)},Q=function(){var b=function(b){var c=a(b.nodes[0]);c.find(".inpoot-main-option.players").click(function(){Z()}),c.find(".inpoot-main-option.settings").click(function(){Y()}),c.find(".inpoot-main-option.mappings").click(function(){W()})};inpoot.utils.modal.show({template:"inpoot.main-content",data:{},behavior:b})},R=function(){for(var a=S(),b=-1,c=0;c<a.length;c++)b<a[c].id&&(b=a[c].id);return b+1},S=function(b){var c=a.storage.getObject("inpoot_action_mappings");if(c||(c=[],a.storage.setObject("inpoot_action_mappings",c)),void 0===b||null===b)return c;for(var d=0;d<c.length;d++)if(c[d].id===b)return c[d]},T=function(b){for(var c=S(),d=0;d<c.length;d++)c[d].id===b&&(c.splice(d,1),a.storage.setObject("inpoot_action_mappings",c))},U=function(){var b=a.extend({},k);return b},V=function(b){B();var c=S(b),d=a.storage.getObject("storedGamepads")||[],e=function(){for(var d=S(),e=0;e<d.length;e++)d[e].id===b&&(d[e]=c,a.storage.setObject("inpoot_action_mappings",d))},f=function(b){var c=a(b.nodes[0]),f=b.data.actionMap;c.find(".inpoot-top-option").click(W),c.find(".inpoot-main-gamepad-options-message input").inpootEdit({onChange:function(a){f.name=a,e()},defaultText:"New Mapping"});for(var g=[{text:"OFF",value:"false",style:"off",message:"Warning, this will remove all mappings that currently use the gamepad"}],h=0;h<d.length;h++)g.push({text:d[h].displayName,value:d[h].gpadType,style:"on",message:"Switching gamepads will remove all mappings from other gamepads",ifNot:["false"]});inpoot.utils.styledSelect({container:a(".inpoot-input-selector.keyboard"),selected:f.keyboard,options:[{text:"ON",value:"true",style:"on"},{text:"OFF",value:"false",style:"off",message:"Warning, this will remove all mappings that currently use the keyboard"}],callBack:function(a){f.keyboard=a.value,e()}}),inpoot.utils.styledSelect({container:a(".inpoot-input-selector.mouse"),selected:f.mouse,options:[{text:"ON",value:"true",style:"on"},{text:"OFF",value:"false",style:"off",message:"Warning, this will remove all mappings that currently use the mouse"}],callBack:function(a){f.mouse=a.value,e()}}),inpoot.utils.styledSelect({container:a(".inpoot-input-selector.gamepad"),selected:f.gamepad,options:g,callBack:function(a){f.gamepad=a.value,e()}});var i,j=function(a){for(var b=-1,c=0;c<a.length;c++)b<a[c].id&&(b=a[c].id);return b+1},k=function(a,b,c){for(var d=f.mapping[a].inputs,g=-1,h=0;h<d.length;h++)if(d[h].id===b){g=h;break}-1!==g&&(d.splice(g,1),e(),c())},l=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c]},m=function(b){var c=a(b.nodes[0]),d=b.data,g=c.find(".inpoot-edit-mapping-gather-inputs.gamepad"),h=g.find(".inpoot-edit-mapping-gather-input-list"),i=c.find(".inpoot-edit-mapping-gather-inputs.keyboard"),j=i.find(".inpoot-edit-mapping-gather-input-list"),k=c.find(".inpoot-edit-mapping-gather-inputs.mouse"),m=k.find(".inpoot-edit-mapping-gather-input-list"),n=d.actionMap,p=d.actionId;a(".inpoot-map-form").addClass("editing"),a(".inpoot-editing-inputs-close").unbind("click").click(function(){a(".inpoot-map-form").removeClass("editing"),o(d.actionId)});for(var q=function(a,b){for(var c=f.mapping[p].inputs,g=d.mapId,h=-1,i=0;i<c.length;i++)if(c[i].id===g){h=i;break}if(-1!==h)for(var j=c[h],k=0;k<j.inputs.length;k++)j.inputs[k].type===a&&j.inputs[k].value===b.value&&(j.inputs.splice(k,1),e())},s=function(b,c){var d="gamepad"===b?h:"mouse"===b?m:j,e=function(d){var e=a(d.nodes[0]);e.find(".inpoot-x-out").click(function(){q(b,c),e.fadeOut(function(){e.remove()})})};a.tmpl("inpoot.action_map.action_edit_action_map_item",{name:c.text},{rendered:e}).appendTo(d)},t=function(a,b,c){console.log("adding",a,b,c),n.id;var f=d.mapId,g=l(n.mapping[p].inputs,f);g.inputs.push({type:a,text:b.text,value:b.value,buttonType:b.buttonType,subType:b.subType,direction:b.direction}),console.log("adding:",b.direction,b),e(),s(a,b)},u={keyboard:{},gamepad:{}},v={},w=d.actionMap.gamepad,x=function(){for(var b in r.gamepad){var c=r.gamepad[b];if(c.type===w)for(var d in c.values)u.gamepad[d]=c.values[d]?c.values[d]:0}for(var e in u.gamepad)Math.abs(u.gamepad[e])<=.5&&v.gamepad&&Math.abs(v.gamepad[e])>.5&&t("gamepad",E(w,e,v.gamepad[e]));if(v=a.extend(!0,{},u),n.keyboard&&"false"!==n.keyboard){for(e in u.keyboard)u.keyboard[e]!==!0||r.keyboard[e]||(t("keyboard",{text:inpoot.getKeyboardMap(e),value:e}),delete u.keyboard[e]);for(e in r.keyboard)r.keyboard[e]&&(u.keyboard[e]=!0)}},y=l(n.mapping[p].inputs,d.mapId),z=y.inputs,A=0;A<z.length;A++)s(z[A].type,z[A]);if(n.mouse&&"false"!==n.mouse){var B=a(".dumbBox-content");k.find(".inpoot-gather-add-button").click(function(){var a=[{text:"mouse up",value:"mouse_up"},{text:"mouse down",value:"mouse_down"},{text:"mouse left",value:"mouse_left"},{text:"mouse right",value:"mouse_right"},{text:"left button",value:"mouse_button_left"},{text:"middle button",value:"mouse_button_middle"},{text:"right button",value:"mouse_button_right"},{text:"back button",value:"mouse_button_back"},{text:"forward button",value:"mouse_button_forward"},{text:"scroll forward",value:"mouse_scroll_forward"},{text:"scroll back",value:"mouse_scroll_back"}];inpoot.utils.optionBox({title:void 0,container:B,options:a,maxHeight:400,callBack:function(a){t("mouse",a)}})})}if(n.gamepad&&"false"!==n.gamepad){var C=O(n.gamepad),D=[],F=function(a,b,c){D.push({text:a,value:b,data:c})},G=function(a,b){return b[a].name?b[a].name:a};for(var H in C.button)F(G(H,C.button),H,{subType:"button"});for(var I in C.axis_dual)F(G(I,C.axis_dual)+" up",I,{buttonType:"axis_dual",subType:"y",direction:"up"}),F(G(I,C.axis_dual)+" down",I,{buttonType:"axis_dual",subType:"y",direction:"down"}),F(G(I,C.axis_dual)+" left",I,{buttonType:"axis_dual",subType:"x",direction:"left"}),F(G(I,C.axis_dual)+" right",I,{buttonType:"axis_dual",subType:"x",direction:"right"});var J=a(".dumbBox-content");g.find(".inpoot-gather-add-button").click(function(){inpoot.utils.optionBox({title:void 0,container:J,options:D,maxHeight:400,callBack:function(a){t("gamepad",{value:a.value,text:a.text,subType:a.data.subType,buttonType:a.data.buttonType,direction:a.data.direction})}})})}inpoot.utils.poll.setInterval(function(){inpoot.tick(!0),x()},100,"live-mapping")},n=function(b,c){var d=f.mapping[b].inputs;l(d,c);var e=a(".inpoot-map-form-left-hidden-inner"),g=f.mapping[b].descr?f.mapping[b].descr:b;e.find(".inpoot-editing-inputs-title").html(g);var h=0;f.keyboard&&"false"!==f.keyboard&&h++,f.mouse&&"false"!==f.mouse&&h++,f.gamepad&&"false"!==f.gamepad&&h++,a.tmpl("inpoot.action_map.action_edit_mapping",{actionMap:f,actionId:b,mapId:c,inputCount:h},{rendered:m}).appendTo(a(".inpoot-map-form-right-inner").html(""))},o=function(b){inpoot.utils.poll.clear("live-mapping");var c=f.mapping[b],d=function(c){var d=a(c.nodes[0]),g=c.data,h=function(){f.mapping[b].inputs=f.mapping[b].inputs||[];var c=f.mapping[b].inputs,g=j(c);c.push({id:g,inputs:[]}),e(),a.tmpl("inpoot.action_map.action_edit_action_input_hidden",[{id:g,inputs:[]}],{rendered:i}).appendTo(d.find(".inpoot-main-gamepad-edit-action-options-list"))},i=function(c){var d=a(c.nodes[0]),e=c.data;d.click(function(){n(b,e.id)}),d.find(".inpoot-x-out").click(function(a){a.preventDefault(),a.stopPropagation(),k(b,e.id,function(){d.fadeOut("fast",function(){d.remove()})})}),d.fadeIn("fast")};d.find(".inpoot-main-gamepad-edit-action-options").click(h),a.tmpl("inpoot.action_map.action_edit_action_input",g.inputs||[],{rendered:i}).appendTo(d.find(".inpoot-main-gamepad-edit-action-options-list").html(""))},g={actionId:b,descr:c.descr,inputs:c.inputs};a.tmpl("inpoot.action_map.action_edit_action_inputs",g,{rendered:d}).appendTo(a(".inpoot-map-form-right-inner").html(""))},p=function(b,c){i=b;var d=function(b){var c=a(b.nodes[0]),d=b.data;c.click(function(){a(".inpoot-edit-action-map-list-group-action").removeClass("selected"),c.addClass("selected"),o(d.actionId)})};a.tmpl("inpoot.action_map.action_list_item",c,{rendered:d}).appendTo(a(".inpoot-map-form-middle-inner").html("")),a(".inpoot-edit-action-map-list-group-action").length>0&&a(a(".inpoot-edit-action-map-list-group-action")[0]).click()},q=function(b){var c=a(b.nodes[0]),d=b.data;c.click(function(){a(".inpoot-edit-action-map-list-group").removeClass("selected"),c.addClass("selected"),p(d.name,d.actions)})},s=function(a){var b={},c=[],d=function(a,d,e){c[b[a]].actions.push({actionId:d,category:a,descr:e.descr||d,inputs:e.inputs})};for(var e in a){var f=a[e];f.category?(void 0===b[f.category]&&(b[f.category]=c.length,c.push({actions:[],name:f.category})),d(f.category,e,f)):(void 0===b.other&&(b.other=c.length,c.push({actions:[],name:"other"})),d("other",e,f))}return c};a.tmpl("inpoot.action_map.action_list",s(f.mapping),{rendered:q}).appendTo(a(".inpoot-map-form-left-inner")),a(".inpoot-edit-action-map-list-group").length>0&&a(a(".inpoot-edit-action-map-list-group")[0]).click()};"click to edit"===c.extra&&(c.extra="",e()),inpoot.utils.modal.show({template:"inpoot.action_map",data:{actionMap:c,gamepads:d},behavior:f})},W=function(){var b=function(){var b=S(),c={name:"New Mapping",extra:"click to edit",gamepad:!1,keyboard:!0,mouse:!0,id:R(),mapping:U()};b.push(c),a.storage.setObject("inpoot_action_mappings",b)},c=function(){var b=a(".inpoot-mappings-list"),c=function(b){var c=a(b.nodes[0]);c.find(".inpoot-mapping-item-delete").click(function(a){a.preventDefault(),a.stopPropagation(),c.find(".inpoot-mapping-item-inputs").stop(!0,!0).hide(),c.find(".inpoot-mapping-item-delete-confirm").stop(!0,!0).fadeIn("fast")}),c.find(".inpoot-mapping-item-delete-confirm-cancel").click(function(a){a.preventDefault(),a.stopPropagation(),c.find(".inpoot-mapping-item-delete-confirm").stop(!0,!0).hide(),c.find(".inpoot-mapping-item-inputs").stop(!0,!0).fadeIn("fast")}),c.find(".inpoot-mapping-item-delete-confirm-okay").click(function(a){a.preventDefault(),a.stopPropagation(),c.slideUp(function(){c.remove(),T(b.data.id),inpoot.utils.modal.expand()})}),c.click(function(){V(b.data.id)})},d=S();b.html(""),a.tmpl("inpoot.mapping-list",d,{rendered:c}).appendTo(b),inpoot.utils.modal.expand()},d=function(d){var e=a(d.nodes[0]);e.find(".inpoot-top-option").click(Q),e.find(".inpoot-message-button").click(function(){b(),c()}),c()};inpoot.utils.modal.show({template:"inpoot.mappings",data:{},behavior:d})},X=function(b){var c,d,e,f=function(b){d=b,e=0,inpoot.utils.poll.clear("monitor-callibration"),a(".pressed-now").remove("pressed-now"),h()},g=function(){inpoot.utils.poll.clear("please-stop"),inpoot.utils.poll.clear("single-button-press"),inpoot.utils.poll.clear("continue-monitoring"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").stop(!0,!0).hide(),a(".gamepad-button").removeClass("mapped").removeClass("mapping").removeClass("up").removeClass("down").removeClass("right").removeClass("left"),i=!1,d=[],e=0},h=function(){if(e<d.length){var c=d[e],f=inpoot.gamepads[b.gpadType],g=f[c.type][c.bid],l=g.name||c.bid,m=c.text||"",n=c.style||" ";a(".gamepadclass-"+c.bid).addClass("mapping "+n),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").removeClass("thanks").find(".inpoot-gamepad-calibrate-gamepad-3d-presskey-text").html("PRESS <span class='inpoot-gamepad-presskey-bold'> "+l+" "+m+" </span>"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").stop(!0,!0).show(),j(function(d){var f=N(b.gpadType);"button"===c.type?f.buttonToRaw[d.type][c.bid]=d.number:"axis_dual"===c.type&&("up"===c.style||"down"===c.style?(f.buttonToRaw.axis_dual[c.bid].y=d.number,f.rawToButton.axesMap[c.bid+"down"]={bid:c.bid,index:d.number,subType:"y",direction:"down"},f.rawToButton.axesMap[c.bid+"up"]={bid:c.bid,index:d.number,subType:"y",direction:"up"}):(f.buttonToRaw.axis_dual[c.bid].x=d.number,f.rawToButton.axesMap[c.bid+"left"]={bid:c.bid,index:d.number,subType:"x",direction:"left"},f.rawToButton.axesMap[c.bid+"right"]={bid:c.bid,index:d.number,subType:"x",direction:"right"}));var g=!1,j="button"===d.type?"buttons":"axes";"up"===c.style||"down"===c.style?g="y":("left"===c.style||"right"===c.style)&&(g="x"),f.rawToButton[j][d.number]={type:c.type,bid:c.bid,subType:g},P(),a(".gamepadclass-"+c.bid).addClass("mapped"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").addClass("thanks"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").stop(!0,!0).fadeOut(500,function(){a(".gamepadclass-"+c.bid).removeClass("mapped").removeClass("mapping").removeClass(n),e++,inpoot.utils.poll.setTimeout(function(){i=!1,h()},300,"please-stop")})})}else a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").removeClass("thanks").stop(!0,!0).hide(),k()},i=!1,j=function(a){for(var c=A(),d=[],e=0;e<c.length;e++)c[e].gamepad.gpadType===b.gpadType&&d.push(c[e]);inpoot.utils.poll.setInterval(function(){for(var b=z(),c=0;c<d.length;c++){var e=d[c],f=b[e.gamepadIndex];if(f){for(var g=0;g<f.buttons.length;g++)f.buttons[g]>.5&&!i&&(i=!0,inpoot.utils.poll.clear("single-button-press"),a({type:"button",number:g,value:f.buttons[g]}));for(var h=0;h<f.axes.length;h++)Math.abs(f.axes[h])>.7&&!i&&(i=!0,inpoot.utils.poll.clear("single-button-press"),a({type:"axis",number:g,value:f.axes[h]}))}}},50,"single-button-press")},k=function(){var c=N(b.gpadType);if(inpoot.gamepads[b.gpadType],c){var d=function(){inpoot.utils.poll.setTimeout(function(){i=!1,e()},100,"continue-monitoring")},e=function(){j(function(b){console.log(b),a(".pressed").removeClass("pressed");var e="button"===b.type?"buttons":"axes",f=c.rawToButton[e][b.number];void 0===f&&console.log(c.rawToButton,c.rawToButton[e],e,b.number);var g=" ";f&&f.subType&&("y"===f.subType?g=b.value>0?"down":"up":"x"===f.subType&&(g=b.value>0?"right":"left")),a(".gamepad-button.gamepadclass-"+f.bid).addClass("pressed "+g),inpoot.utils.poll.setTimeout(function(){a(".gamepad-button.gamepadclass-"+f.bid).removeClass("pressed").removeClass(g)},350),d()})};e()}},l=function(d){for(var e,h=inpoot.gamepads[b.gpadType],i=A(),j=0;j<i.length;j++)i[j].gamepad.gpadType!==b.gpadType||(e=i[j]);inpoot.utils.poll.setTimeout(function(){var b,e=a(d.nodes[0]);c=e,e.find(".inpoot-top-option").click(function(){Y()});for(var f in h.button){var g=h.button[f];b=g.face||"front",a(".inpoot-gamepad-calibrate-face."+b).append('<span class="gamepad-button gamepadclass-'+f+" "+(g.style||"")+" "+(g.bclass||"")+' " style="left:'+g.x+"%; top:"+g.y+'%;"><span class="gamepad-button-inner">'+(g.text||"&nbsp;")+'<span class="gamepad-button-inner-dec"></span></span></span>')}for(var i in h.axis_dual){var j=h.axis_dual[i];b=j.face||"front",a(".inpoot-gamepad-calibrate-face."+b).append('<span class="gamepad-button gamepadclass-'+i+" "+(j.style||"")+" "+(j.bclass||"")+' " style="left:'+j.x+"%; top:"+j.y+'%;"><span class="gamepad-button-inner">'+(j.text||"&nbsp;")+'<span class="gamepad-button-inner-dec"></span></span></span>')}a(".inpoot-gamepad-calibrate-layout").fadeIn();var l=a(".inpoot-gamepad-calibrate-gamepad-3d-holder");l.addClass("turned"),inpoot.utils.poll.setInterval(function(){l.hasClass("turned")?l.removeClass("turned"):l.addClass("turned")},4e3,"gpad-rotation"),k()},300,"gpad-buttons"),h=inpoot.gamepads[b.gpadType],a(".inpoot-gamepad-calibrate-panel-button.all").click(function(){g();var a=[],b=function(b,c,d,e){a.push({type:c,bid:b,style:d,text:e})};for(var c in h.button)b(c,"button");for(var d in h.axis_dual)b(d,"axis_dual","up","up"),b(d,"axis_dual","down","down"),b(d,"axis_dual","left","left"),b(d,"axis_dual","right","right");f(a)}),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey .inpoot-x-out").click(function(){g(),k()});var l=function(b,c,d){var e=c.name?c.name:b,h=a('<div class="button-configure">'+e+"</div>");h.hover(function(){a(".gamepadclass-"+b).addClass("pressed")},function(){a(".gamepadclass-"+b).removeClass("pressed")}),h.click(function(){g(),"axis_dual"!==d?f([{type:d,bid:b}]):f([{type:d,bid:b,style:"up",text:"up"},{type:d,bid:b,style:"down",text:"down"},{type:d,bid:b,style:"left",text:"left"},{type:d,bid:b,style:"right",text:"right"}])}),a(".inpoot-gamepad-calibrate-panel-inner-content").append(h)};for(var m in h.button)l(m,h.button[m],"button");for(var n in h.axis_dual)l(n,h.axis_dual[n],"axis_dual")};inpoot.utils.modal.show({template:"inpoot.gamepad-calibrate",data:b,behavior:l})},Y=function(){var b,c=[],d=function(c){var d=a(c.nodes[0]);b=d,d.find(".inpoot-top-option").click(function(){Q()}),d.find(".inpoot-help").toggle(function(){a(".inpoot-main-gamepad-options-summary").stop(!0,!0).slideDown(function(){inpoot.utils.modal.expand()})},function(){a(".inpoot-main-gamepad-options-summary").stop(!0,!0).slideUp(function(){inpoot.utils.modal.expand()})})};inpoot.utils.modal.show({template:"inpoot.gamepad-content",data:{},behavior:d}),j.length;var e=function(b){a(b.nodes[0]).click(function(){a(this).hasClass("active")&&X(b.data)})},f=function(c){b.find(".inpoot-gamepad-list").html(""),a.tmpl("inpoot.gamepad-gamepad",{gamepads:c,gamepadPP:e}).appendTo(b.find(".inpoot-gamepad-list"))},g=function(){var b=[];j=A();for(var d=a.storage.getObject("storedGamepads")||[],e=0;e<d.length;e++)b.push({id:d[e].id,displayName:d[e].displayName,gpadType:d[e].gpadType,active:!1});for(var g=0;g<j.length;g++){for(var h=!1,i=0;i<b.length;i++)b[i].id===j[g].gamepad.id&&(b[i].active=!0,h=!0);h||(b.push({id:j[g].gamepad.id,displayName:j[g].gamepad.displayName,active:!0,gpadType:j[g].gamepad.gpadType}),d.push({id:j[g].gamepad.id,displayName:j[g].gamepad.displayName,gpadType:j[g].gamepad.gpadType}),a.storage.setObject("storedGamepads",d))}var k=!1;if(b.length!==c.length&&(k=!0),!k){for(var l=0,m=0;m<b.length;m++)for(var n=0;n<c.length;n++)c[n].id===b[m].id&&c[n].active===b[m].active&&l++;l!==b.length&&(k=!0)}k&&(f(b),inpoot.utils.modal.expand()),c=b};f(),inpoot.utils.poll.setInterval(g,200)},Z=function(){var b,c=function(b){a.storage.setObject("inpoot_stored_players",b)},d=function(){var a=inpoot.gamepads["XBOX 360"].axis_dual,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({axisName:c,axisTitle:a[c].name,axisType:"y"});return b},e=function(b,d,e){for(var f=a.storage.getObject("inpoot_stored_players")||[],g=-1,h=0;h<f.length;h++)f[h].number===b&&(g=h);-1!==g&&(f[g]=d,c(f),e&&e())},f=function(b){for(var c=a.storage.getObject("inpoot_action_mappings")||[],d=0;d<c.length;d++)if(c[d].id===b)return c[d];return!1},g=function(b){var d=a.storage.getObject("inpoot_stored_players");for(var e in d)if(d[e].number===b.number)return d[e]=b,c(d),void 0},h=function(){var d=a.storage.getObject("inpoot_stored_players")||[];inpoot.players=[];for(var e=0;q>e;e++){for(var g=-1,h=0;h<d.length;h++)d[h].number===e+1&&(g=h);if(-1!==g){var i=f(d[g].actionMapId);i&&(d[g].title=i.name,d[g].gamepad=i.gamepad,d[g].keyboard=i.keyboard,d[g].mouse=i.mouse),inpoot.players.push(d[g])}else inpoot.players.push({number:e+1,title:!1,actionMapId:!1,keyboard:!1,mouse:!1,gamepad:!1,options:{},gamepadIndex:!1})}c(inpoot.players),a.tmpl("inpoot.player",inpoot.players,{rendered:j}).appendTo(b.find(".inpoot-players-list").html(""))},i=function(c){var d=a(c.nodes[0]);b=d,d.find(".inpoot-top-option").click(function(){Q()}),h()},j=function(b){var c=a(b.nodes[0]);if(b.data.actionMapId===!1&&c.addClass("player-error"),c.find(".inpoot-player-actionmap").click(function(){var c=[],d=a.storage.getObject("inpoot_action_mappings");c.push({text:"[ NONE ]",value:!1,data:{name:!1,gamepad:!1,mouse:!0,keyboard:!0,id:!1}});for(var f=0;f<d.length;f++){var g=d[f].name;c.push({text:g,value:d[f].name,data:d[f]})}var i=a(".dumbBox-content");inpoot.utils.optionBox({title:"Select action mapping for this player",container:i,options:c,callBack:function(a){b.data.title=a.data.name,b.data.actionMapId=a.data.id,b.data.gamepad=a.data.gamepad,b.data.keyboard=a.data.keyboard,b.data.mouse=a.data.mouse,e(b.data.number,b.data,h)}})}),b.data.gamepad){var f=z();b.data.options.gpadIndex!==!1&&f[b.data.options.gpadIndex]&&f[b.data.options.gpadIndex].gpadType===b.data.gamepad?c.find(".inpoot-player-gamepad-index").html("Gamepad Slot "+(parseInt(b.data.options.gpadIndex,10)+1)):(b.data.options.gpadIndex=!1,g(b.data),c.find(".inpoot-player-gamepad-index").html("select gamepad"),c.addClass("player-error"))}c.find(".inpoot-player-gamepad-index").click(function(){for(var d=[],e=!1,h=0;4>h;h++)if(f[h]){var i=b.data.gamepad!==f[h].gpadType;i||(e=!0),d.push({value:h,text:"Gamepad Slot "+(h+1)+" : "+f[h].gpadType,disabled:i})}else d.push({value:h,text:"Gamepad Slot "+(h+1)+" : EMPTY",disabled:!0});var j=a(".dumbBox-content"),k=e?!1:"Could not detect gamepads of this type. Make sure your ("+b.data.gamepad+") gamepad is on and press buttons to activate it.";inpoot.utils.optionBox({title:k,container:j,options:d,callBack:function(a){b.data.options.gpadIndex=a.value,c.find(".inpoot-player-gamepad-index").html("Gamepad Slot "+(parseInt(b.data.options.gpadIndex,10)+1)),c.removeClass("player-error"),g(b.data)}})});var i=function(){a(this).html("close");var e=c.find(".inpoot-player-options");e.html("");var f=0;if(b.data.gamepad&&"false"!==b.data.gamepad){for(var h=d(b.data.gamepad),i=0;i<h.length;i++){var j=h[i].axisName;b.data.options.axes=b.data.options.axes||{},b.data.options.axes[j]=void 0===b.data.options.axes[j]?!1:b.data.options.axes[j],h[i].axisInverted=b.data.options.axes[j]}var k=function(c){var d=a(c.nodes[0]),e=c.data,f=c.data.axisName;d.click(function(){e.axisInverted?(e.axisInverted=!1,a(this).find(".inpoot-player-invert-axis-value").html("NORMAL"),a(this).removeClass("inverted-true").addClass("inverted-false")):(e.axisInverted=!0,a(this).find(".inpoot-player-invert-axis-value").html("INVERTED"),a(this).removeClass("inverted-false").addClass("inverted-true")),b.data.options.axes[f]=e.axisInverted,g(b.data)})};h.length>0&&(f++,a.tmpl("inpoot.player-options-title",{title:"Invert Gamepad Y Axes"}).appendTo(e),a.tmpl("inpoot.player-invert-axis",h,{rendered:k}).appendTo(e))}0===f&&a.tmpl("inpoot.player-options-title",{title:"No additional options for this player"}).appendTo(e),e.stop(!0,!0).show(0,inpoot.utils.modal.expand)},j=function(){a(this).html("options"),c.find(".inpoot-player-options").stop(!0,!0).hide(0,inpoot.utils.modal.expand)};c.find(".inpoot-player-options-button.options").toggle(i,j)};inpoot.utils.modal.show({template:"inpoot.player-content",data:{},behavior:i});var k=A().length,l=function(){var b=A();b.length!==k&&(k=b.length,h(),a(".inpoot-option-box-wrapper").remove(),a(".inpoot-option-box-screen").remove())};inpoot.utils.poll.setInterval(l,50,"player-gamepad-scanning")};inpoot.openMenu=function(){m=!0,Q()},inpoot.utils={truncate:function(a,b){return a.length>b?a.substr(0,b-3)+"...":a},optionBox:function(b){var c={};c.container=b.container,c.options=b,c.close=function(){a(".inpoot-option-box-wrapper").remove(),a(".inpoot-option-box-screen").remove(),c.options.onClose&&c.options.onClose()},c.close();var d=a('<div class="inpoot-option-box-screen"></div>'),e=a('<span class="inpoot-option-box-wrapper"></span>'),f=a('<div class="inpoot-option-box"></div>'),g=a('<div class="inpoot-option-box-content"></div>'),h=a('<div class="inpoot-option-box-close">cancel</div>'),i=c.options.title?a('<div class="inpoot-option-box-title">'+c.options.title+"</div>"):a("<div></div>");e.append(f),f.append(h),f.append(i),f.append(g),c.options.maxHeight&&g.css("max-height",c.options.maxHeight+"px").css("overflow-y","auto"),h.click(function(){c.close()});for(var j=function(a){return function(b){b.preventDefault(),a.disabled||(c.close(),c.options.callBack.apply(c,[a]))}},k=0;k<c.options.options.length;k++){var l=c.options.options[k].disabled?" disabled ":"",m=a('<div class="inpoot-option-box-option '+l+'"><a href="#">'+c.options.options[k].text+"</a></div>");m.click(j(c.options.options[k])),m.appendTo(g)}a(".dumbBoxWrap .vertical-offset").append(e),d.appendTo(a(".dumbBoxWrap .vertical-offset")),f.stop(!0,!0).fadeIn("fast")},styledSelect:function(b){var c={},d=b.callBack;c.container=b.container,c.options=b.options;for(var e={},f=a(".dumbBox-content"),g=c.options[0],h=0;h<c.options.length;h++)c.options[h].value===b.selected&&(g=c.options[h]);var i=a('<span class="styled-select-container"></span>'),j=a('<span class="styled-select-value"></span>'),k=a('<span class="styled-select-options"></span>'),l=a('<span class="style-select-left-image"></span>'),m=a('<span class="style-select-right-image"></span>');
return i.append(l),i.append(j),i.append(m),i.append(k),c.container.append(i),c.setValue=function(a){for(var b=0;b<c.options.length;b++)c.options[b].value===a&&(g=c.options[b]);j.html(inpoot.utils.truncate(g.text,25)),j.removeClass().addClass("styled-select-value"),g.style&&j.addClass(g.style)},c.getValue=function(){return g.value},c.container.click(function(){e=inpoot.utils.optionBox({title:void 0,container:f,options:c.options,callBack:function(a){for(var b,h=function(){g=a,d(a),i.removeClass("choosing"),i.find(".styled-select-value").removeClass().addClass("styled-select-value").addClass(a.style).html(inpoot.utils.truncate(a.text,25))},j=0;j<c.options.length;j++)if(c.options[j].value===a.value){b=c.options[j];break}var k=a.ifNot&&-1!==a.ifNot.indexOf(g.value);b.message&&a.value!==g.value&&!k?e=inpoot.utils.optionBox({title:b.message,container:f,options:[{text:"CANCEL",value:"cancel"},{text:"OK",value:"okay"}],callBack:function(a){"okay"===a.value&&h()}}):h()}})}),c.setValue(g.value),c},modal:{showing:!1,buttonPP:function(b){var c=a(b.nodes[0]);c.find("a").click(function(a){a.preventDefault(),b.data.click&&b.data.click(b.data)})},expand:function(){setTimeout(function(){var b=a(".dumbBox-content"),c=a(".dumbBox"),d=b.height(),e=b.width();c.css("height",d),c.css("width",e),setTimeout(function(){b.stop(!0,!0).fadeIn(200)},200)},50)},newContent:function(b,c){var d=this,e=b.behavior?b.behavior:a.noop,f=b.data?b.data:{},g=a(".dumbBox-content");a(".dumbBox");var h=function(){g.stop(!0,!0).hide(),g.html(""),a.tmpl(b.template,f,{rendered:e}).appendTo(g),d.expand()};c?h():g.stop(!0,!0).fadeOut(500,h)},show:function(b){var c=this;if(inpoot.utils.poll.purge(),inpoot.utils.modal.showing)c.newContent(b,!0);else{a.tmpl("inpoot.modal").appendTo(a("body"));var d=a(".dumbBoxWrap"),e=a(".dumbBoxOverlay"),f=a(".dumbBox");a(".dumbBox-content"),a(".dumbBox-buttons"),d.show(),e.stop(!0,!0).fadeIn(100,function(){f.stop(!0,!0).fadeIn(200,function(){c.newContent(b,!0),inpoot.utils.modal.showing=!0})}),a(".vertical-offset").click(function(b){a(b.target).hasClass("vertical-offset")&&c.hide()}),e.click(c.hide)}},hide:function(){inpoot.utils.poll.purge(),inpoot.utils.modal.showing=!1,a(".dumbBoxWrap");var b=a(".dumbBoxOverlay"),c=a(".dumbBox"),d=a(".dumbBox-content"),e=a(".dumbBox-buttons");c.stop(!0,!0).hide(),b.stop(!0,!0).fadeOut(200,function(){d.html(""),e.html(""),a(".dumbBoxWrap").remove()}),m=!1,inpoot.refreshParams()}},poll:{pollId:0,repository:{},getPollId:function(){return this.pollId++,"poll-"+this.pollId},clear:function(a){var b=this.repository[a];b&&("timeout"===b.type?clearTimeout(b.pollObj):clearInterval(b.pollObj),delete this.repository[a])},purge:function(){for(var a in this.repository){var b=this.repository[a];"timeout"===b.type?clearTimeout(b.pollObj):clearInterval(b.pollObj),delete this.repository[a]}},setTimeout:function(a,b,c){c=c||this.getPollId();var d={type:"timeout",pollObj:setTimeout(a,b)};this.repository[c]=d},setInterval:function(a,b,c){c=c||this.getPollId();var d={type:"interval",pollObj:setInterval(a,b)};this.repository[c]=d}}},a.template("inpoot.main-content",['<div class="inpoot-main-wrapper">','<div class="inpoot-main-menu">','<div class="inpoot-main-option players">','<span class="inpoot-main-options-image"><span class="inpoot-input-icon players"></span></span>','<span class="inpoot-main-options-title">Players</span>',"</div>",'<div class="inpoot-main-option mappings">','<span class="inpoot-main-options-image"><span class="inpoot-input-icon gamepad"></span></span>','<span class="inpoot-main-options-title">Mappings</span>',"</div>",'<div class="inpoot-main-option settings">','<span class="inpoot-main-options-image"><span class="inpoot-input-icon settings"></span></span>','<span class="inpoot-main-options-title">calibrate</span>',"</div>","</div>","</div>"].join("")),a.template("inpoot.action_map",['<div class="inpoot-edit-action-map-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">',"Edit Action Map","</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-main-gamepad-options-message inpoot-no-select">','<div class="inpoot-options-left">','<input type="text" value="${actionMap.name}" id="inpoot-action-edit-name" size="16"/>',"</div>",'<div class="inpoot-options-right">','<div class="inpoot-input-selector keyboard">',"</div>",'<div class="inpoot-input-selector mouse">',"</div>",'<div class="inpoot-input-selector gamepad">',"</div>","</div>",'<div class="inpoot-options-clear"></div>',"</div>",'<div class="inpoot-map-form">','<div class="inpoot-map-form-left"><div class="inpoot-map-form-left-inner"></div></div>','<div class="inpoot-map-form-middle"><div class="inpoot-map-form-middle-inner"></div></div>','<div class="inpoot-map-form-left-hidden"><div class="inpoot-map-form-left-hidden-inner">','<div class="inpoot-editing-inputs-title"></div>','<div class="inpoot-editing-inputs-close"><div class="inpoot-close-edit-mapping">CLOSE</div></div>',"</div></div>",'<div class="inpoot-map-form-right"><div class="inpoot-map-form-right-inner"></div></div>',"</div>","</div>"].join("")),a.template("inpoot.action_map.action_list",['<div class="inpoot-edit-action-map-list-group">','<div class="inpoot-edit-action-map-list-group-name">${name}<span class="inpoot-selected-arrow"></span></div>',"</div>"].join("")),a.template("inpoot.action_map.action_list_item",['<div class="inpoot-edit-action-map-list-group-action">{%if (actionId != descr && descr != undefined) %} ${inpoot.utils.truncate(descr, 22)} {%else%} ${inpoot.utils.truncate(actionId, 22)} {%/if%}<span class="inpoot-selected-arrow"></span></div>'].join("")),a.template("inpoot.action_map.action_list_mappings",['<div class="inpoot-edit-action-map-list-mappings">',"list-of-mappings","</div>"].join("")),a.template("inpoot.action_map.action_edit_mapping",['<div class="inpoot-edit-action-map-edit_mapping input-count-${inputCount}">','{%if (actionMap.keyboard && actionMap.keyboard != "false")%}','<div class="inpoot-edit-mapping-gather-inputs keyboard">','<div class="inpoot-edit-mapping-gather-title inpoot-input-icon-xsmall-container"><span class="inpoot-input-icon-xsmall"></span>KEYBOARD  <span class="inpoot-gather-add-button">PRESS KEYS</span></div>','<div class="inpoot-edit-mapping-gather-input-list">',"</div>","</div>","{%/if%}",'{%if (actionMap.gamepad && actionMap.gamepad != "false")%}','<div class="inpoot-edit-mapping-gather-inputs gamepad">','<div class="inpoot-edit-mapping-gather-title inpoot-input-icon-xsmall-container"><span class="inpoot-input-icon-xsmall"></span>GAMEPAD <span class="inpoot-gather-add-button active">CLICK -or- PRESS BUTTONS</span></div>','<div class="inpoot-edit-mapping-gather-input-list"></div>',"</div>","{%/if%}",'{%if (actionMap.mouse && actionMap.mouse != "false")%}','<div class="inpoot-edit-mapping-gather-inputs mouse">','<div class="inpoot-edit-mapping-gather-title inpoot-input-icon-xsmall-container"><span class="inpoot-input-icon-xsmall"></span>MOUSE <span class="inpoot-gather-add-button active">CLICK to add mouse input</span></div>','<div class="inpoot-edit-mapping-gather-input-list"></div>',"</div>","{%/if%}","</div>"].join("")),a.template("inpoot.action_map.action_edit_action_map_item",['<div class="inpoot-edit-mapping-gather-input-list-item"><span class="inpoot-x-out"></span>${name}</div>'].join("")),a.template("inpoot.action_map.action_edit_action_inputs",["<div>",'<div class="inpoot-edit-action-top"><span class="inpoot-edit-action-title">${descr}</span> {%if actionId != descr%}<span class="inpoot-edit-action-title-actionid"> : ${actionId} </span>{%/if%}</div>','<div class="inpoot-main-gamepad-edit-action-options"> [+] New Input Combination </div>','<div class="inpoot-main-gamepad-edit-action-options-list"></div>',"</div>"].join("")),a.template("inpoot.action_map.action_edit_action_input",['<div class="inpoot-edit-action-keys">','<div class="inpoot-x-out"></div>','<div class="inpoot-edit-action-keys-list">',"{%if inputs.length == 0%}",'<span class="inpoot-edit-action-keys-list-and edit">(click to edit)</span> ',"{%else%}",'{%tmpl(inputs) "inpoot.action_map.action_edit_action_input_listing"%}',"{%/if%}","</div>","</div>"].join("")),a.template("inpoot.action_map.action_edit_action_input_listing",['<span class="inpoot-input-item ${type}"><span class="inpoot-input-icon-xsmall-container"><span class="inpoot-input-listing-title-type inpoot-input-icon-xsmall">&nbsp;</span><span class="inpoot-input-listing-title">${text}</span></span></span>'].join("")),a.template("inpoot.action_map.action_edit_action_input_hidden",['<div class="inpoot-edit-action-keys hide-action-inputs">','<div class="inpoot-x-out"></div>','<div class="inpoot-edit-action-keys-list">{%if inputs.length == 0%} <span class="inpoot-edit-action-keys-list-and edit">(click to edit)</span> {%else%} yo {%/if%}</div>',"</div>"].join("")),a.template("inpoot.mappings",['<div class="inpoot-mappings-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">',"view and edit stored input to action maps","</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-main-gamepad-options-message">','<span class="inpoot-message-button">[+] Create New Mapping</span>',"</div>",'<div class="inpoot-mappings-list"></div>',"</div>"].join("")),a.template("inpoot.mapping-list",['<div class="inpoot-mapping-item">','<span class="inpoot-mapping-item-left">','<span class="inpoot-mapping-item-delete">&nbsp;</span>','<span class="inpoot-mapping-item-name">${name} <span class="inpoot-parens">{%if extra%}(${extra}){%/if%}</span></span>',"</span>",'<span class="inpoot-mapping-item-delete-confirm">','<span class="inpoot-mapping-item-delete-confirm-okay inpoot-mapping-item-delete-confirm-button">Delete</span>','<span class="inpoot-mapping-item-delete-confirm-cancel inpoot-mapping-item-delete-confirm-button">Cancel</span>',"</span>",'<span class="inpoot-mapping-item-inputs">','{%if keyboard && keyboard != "false"%}','<span class="inpoot-mapping-item-inputs-input keyboard">&nbsp;</span>',"{%/if%}",'{%if gamepad && gamepad != "false"%}','<span class="inpoot-mapping-item-inputs-input gamepad">&nbsp;</span>',"{%/if%}",'{%if mouse && mouse != "false"%}','<span class="inpoot-mapping-item-inputs-input mouse">&nbsp;</span>',"{%/if%}","</span>","</div>"].join("")),a.template("inpoot.gamepad-calibrate",['<div class="inpoot-gamepad-calibrate-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">','press buttons to verify the <span class="inpoot-top-highlight">${gpadType}</span> gamepad\'s configuration',"</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-gamepad-calibrate-content">','<div class="inpoot-gamepad-calibrate-layout" style="display:none;">','<div class="inpoot-gamepad-calibrate-gamepad-3d-holder">','<div class="inpoot-gamepad-calibrate-face top"></div>','<div class="inpoot-gamepad-calibrate-face bottom"></div>','<div class="inpoot-gamepad-calibrate-face left"></div>','<div class="inpoot-gamepad-calibrate-face right"></div>','<div class="inpoot-gamepad-calibrate-face front"></div>','<div class="inpoot-gamepad-calibrate-face back"></div>',"</div>",'<div class="inpoot-gamepad-calibrate-gamepad-3d-presskey">','<div class="inpoot-gamepad-calibrate-gamepad-3d-presskey-text"></div>','<div class="inpoot-x-out"></div>',"</div>","</div>",'<div class="inpoot-gamepad-calibrate-panel">','<div class="inpoot-gamepad-calibrate-panel-inner">','<div class="inpoot-gamepad-calibrate-panel-button all">Click to configure all buttons</div>','<div class="inpoot-gamepad-calibrate-panel-inner-content">',"</div>","</div>","</div>","</div>","</div>"].join("")),a.template("inpoot.gamepad-content",['<div class="inpoot-gamepad-wrapper">','<div class="inpoot-top with-icon">','<span class="inpoot-help"></span>','<span class="inpoot-top-title">',"calibrate different gamepad types","</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-gamepad-list"></div>',"</div>"].join("")),a.template("inpoot.gamepad-gamepad",['<div class="inpoot-main-gamepad-options-summary">',"Verify that your gamepads' buttons are configured correctly. </br>Not right? Click and edit each type of gamepads' configurations.","</div>",'<div class="inpoot-main-gamepad-options-message">',"Hold down keys on your gamepad to load / calibrate gamepads","</div>","{%if gamepads%}",'{%tmpl(gamepads, {rendered:gamepadPP}) "inpoot.gamepad-gamepad-indy"%}',"{%/if%}"].join("")),a.template("inpoot.gamepad-gamepad-indy",['<div class="inpoot-main-gamepad-option {%if active%}active{%/if%}">','<span class="inpoot-gamepad-option-left">','<span class="inpoot-input-icon gamepad"></span>',"</span>",'<span class="inpoot-gamepad-option-right">',"${displayName}","</br>",'<span class="inpoot-gamepad-option-subinfo">',"{%if active%}","Click to calibrate this type of gamepad","{%else%}","To calibrate, ensure your gamepad is on. Hit keys to activate it.","{%/if%}","</span>","</span>",'<span class="inpoot-status-bar"></span>',"</div>"].join("")),a.template("inpoot.player-content",['<div class="inpoot-player-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">edit player mappings and options</span>','<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-players-list">',"</div>","</div>"].join("")),a.template("inpoot.player",['<div class="inpoot-player inpoot-no-select">','<div class="inpoot-player-info">','<div class="inpoot-player-left">','<div class="inpoot-player-title">','<span class="inpoot-player-icon  inpoot-mapping-item-inputs-input players"></span>','<span class="inpoot-player-number">Player ${number}</span>',"</div>","</div>",'<div class="inpoot-player-right">','<span class="inpoot-player-options-button options inpoot-gather-add-button active">',"options","</span>",'<span class="inpoot-player-actionmap inpoot-gather-add-button active">',"{%if title%}",'<span class="inpoot-player-actionmap-title">${title}</span>','<span class="inpoot-player-input-types">','{%if keyboard && keyboard != "false"%}','<span class="keyboard"><span class="inpoot-input-icon-xsmall"></span></span>',"{%/if%}",'{%if mouse && mouse != "false"%}','<span class="mouse"><span class="inpoot-input-icon-xsmall"></span></span>',"{%/if%}",'{%if gamepad && gamepad != "false"%}','<span class="gamepad"><span class="inpoot-input-icon-xsmall"></span></span>',"{%/if%}","</span>","{%else%}","( click to set action mapping )","{%/if%}","</span>",'{%if gamepad && gamepad != "false"%}','<span class="inpoot-player-options-button inpoot-gather-add-button active inpoot-player-gamepad-index">gpad</span>',"{%/if%}","</div>","</div>",'<div class="inpoot-player-options"></div>',"</div>"].join("")),a.template("inpoot.player-invert-axis",['<span class="inpoot-player-invert-axis inverted-${axisInverted}">','<span class="inpoot-player-invert-axis-name">${axisTitle}</span>','<span class="inpoot-player-invert-axis-value">',"{%if axisInverted%}","INVERTED","{%else%}","NORMAL","{%/if%}","</span>","</span>"].join("")),a.template("inpoot.player-options-title",['<div class="inpoot-player-options-title">${title}</div>'].join("")),a.template("inpoot.modal",['<div class="dumbBoxWrap">','<div class="dumbBoxOverlay">',"&nbsp;","</div>",'<div class="vertical-offset">','<div class="dumbBox">','<div class="dumbBox-content-wrapper">','<div class="dumbBox-content"></div>',"</div>","</div>","</div>","</div>"].join("")),a.template("inpoot.modal.buttons",['<span class="dumbBox-button">','<a href="#">${title}</a>',"</span>"].join(""))}($),function(a){a.storage=window.localStorage,Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))},Storage.prototype.getObject=function(a){var b=this.getItem(a);return b=b&&JSON.parse(b),b=b?b:[]},Storage.prototype.removeObject=function(a){var b=this.removeItem(a);return b&&JSON.parse(b)}}($),function(a){var b={init:function(b){var c=a(this[0]),d={onChange:a.noop,defaultText:""},e=a.extend({},d,b);return c.data("plugin-options",e),c.focus(function(){a(this).val()===e.defaultText&&a(this).val("")}),c.keyup(function(b){(13===b.which||27===b.which)&&a(this).blur()}),c.blur(function(){""===a.trim(a(this).val())&&a(this).val(e.defaultText),e.onChange(a(this).val())}),c}};a.fn.inpootEdit=function(a){return 0!==this.length?b[a]?b[a].apply(this,Array.prototype.slice.call(arguments,1)):b.init.apply(this,arguments):void 0}}($),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=new Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),function(a){"use strict";a.gamepads={},a.gamepads["XBOX 360"]={displayName:"XBOX 360 Controller",idMatches:[["45e","28e"],["45e","2a1"],["XInput","GAMEPAD"]],button:{dpadUp:{name:"dpad up",style:"dpadUp",x:30,y:45},dpadDown:{name:"dpad down",style:"dpadDown",x:30,y:65},dpadLeft:{name:"dpad left",style:"dpadLeft",x:25,y:55},dpadRight:{name:"dpad right",style:"dpadRight",x:35,y:55},start:{style:"round_small",text:"s",bclass:"xbox-white",x:60,y:20},back:{style:"round_small",text:"b",bclass:"xbox-white",x:40,y:20},on:{style:"round_large",text:"ON",bclass:"xbox-center",x:50,y:20},A:{style:"round",text:"A",bclass:"xbox-a",x:80,y:30},B:{style:"round",text:"B",bclass:"xbox-b",x:86,y:20},X:{style:"round",text:"X",bclass:"xbox-x",x:74,y:20},Y:{style:"round",text:"Y",bclass:"xbox-y",x:80,y:10},lBumper:{name:"left bumper",style:"bumper",text:"LB",face:"top",x:25,y:70},rBumper:{name:"right bumper",style:"bumper",text:"RB",face:"top",x:75,y:70},lStickClick:{name:"left stick click",style:"stick_click",target:"lStick",x:20,y:20},rStickClick:{name:"right stick click",style:"stick_click",target:"rStick",x:70,y:55},lTrigger:{name:"left trigger",style:"trigger",text:"LT",face:"top",x:25,y:20},rTrigger:{name:"right trigger",style:"trigger",text:"RT",face:"top",x:75,y:20}},axis_dual:{lStick:{name:"left stick",style:"axis",x:20,y:20},rStick:{name:"right stick",style:"axis",x:70,y:55}}},a.gamepads["Playstation 3"]={displayName:"Playstation 3 Controller",idMatches:[["54c","268"]],button:{dpadUp:{style:"dpadUp",x:20,y:12},dpadDown:{style:"dpadDown",x:20,y:28},dpadLeft:{style:"dpadLeft",x:15,y:20},dpadRight:{style:"dpadRight",x:25,y:20},start:{style:"round_small",text:"st",bclass:"ps-mid",x:60,y:20},back:{style:"round_small",text:"sl",bclass:"ps-mid",x:40,y:20},on:{style:"round",text:"ON",bclass:"",x:50,y:32},X:{style:"round",text:"X",bclass:"ps-x",x:80,y:30},SQUARE:{style:"round",text:"[]",bclass:"ps-square",x:74,y:20},CIRCLE:{style:"round",text:"O",bclass:"ps-circle",x:86,y:20},TRIANGLE:{style:"round",text:"^",bclass:"ps-triangle",x:80,y:10},lBumper:{style:"bumper",text:"L1",bclass:"ps-bumper",face:"top",x:25,y:70},rBumper:{style:"bumper",text:"R1",bclass:"ps-bumper",face:"top",x:75,y:70},lStickClick:{style:"stick_click",target:"lStick",x:30,y:45},rStickClick:{style:"stick_click",target:"rStick",x:70,y:45},lTrigger:{style:"trigger",text:"L2",bclass:"ps-trigger",face:"top",x:25,y:20},rTrigger:{style:"trigger",text:"R2",bclass:"ps-trigger",face:"top",x:75,y:20}},axis_dual:{lStick:{style:"axis",x:30,y:45},rStick:{style:"axis",x:70,y:45}}},a.gamepads["Logitech F310"]={displayName:"Logitech F310 Controller",idMatches:[["46d","c21d"],["46d","c21e"],["46d","c216"]],button:{}}}(inpoot),function(a){"use strict";a.keyboards={},a.currentKeyboard="wasd",a.setCurrentKeyboard=function(b){a.currentKeyboard=b},a.getKeyboardMap=function(b){return a.keyboards[a.currentKeyboard][b]},a.keyboards.wasd={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Spacebar",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Arrow Left",38:"Arrow Up",39:"Arrow Right",40:"Arrow Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",189:"_-",187:"=+",186:";:",59:";:",61:"=+",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"Windows",96:"0 (Num Lock)",97:"1 (Num Lock)",98:"2 (Num Lock)",99:"3 (Num Lock)",100:"4 (Num Lock)",101:"5 (Num Lock)",102:"6 (Num Lock)",103:"7 (Num Lock)",104:"8 (Num Lock)",105:"9 (Num Lock)",106:"* (Num Lock)",107:"+ (Num Lock)",109:"- (Num Lock)",110:". (Num Lock)",111:"/ (Num Lock)",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",124:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",188:",<",190:".>",191:"/?",192:"`~",220:"|",221:"]}",222:"'\"",219:"[{"}}(inpoot);